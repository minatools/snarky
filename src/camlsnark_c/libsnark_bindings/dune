(library
 (name snarky_libsnark_bindings)
 (public_name snarky.libsnark_bindings)
 (inline_tests)
 (libraries
   camlsnark_c_bindings
   core
   ctypes_foreign_libffi
   snarky.cpp_string
   snarky.cpp_vector
   snarky.backendless)
 (foreign_stubs
  (language c)
  (names libsnark_ffi_bindings)
  (flags :standard -lstdc++ -lpthread))
 (c_library_flags (:standard \ -pedantic) (-I re2_c/libre2))
 (preprocess (pps ppx_custom_printf ppx_sexp_conv ppx_bin_prot ppx_inline_test)))

(rule
 (targets libsnark_ffi_bindings.c libsnark_ffi_bindings.ml)
 (deps template_caml_curve_h.hpp)
 (action
  (run ../camlsnark_ctypes_stubs.exe)))

;; NB: these .h files (originally: common.h) do not seem to be needed.
(rule
 (targets template_caml_curve_h.hpp) ;; caml_logging.h caml_strings.h caml_utils.h caml_vectors.h)
 (deps
   ../libsnark-caml/caml/template_caml_curve_h.hpp)
   ;; ../libsnark-caml/caml/caml_logging.h
   ;; ../libsnark-caml/caml/strings.h
   ;; ../libsnark-caml/caml/caml_utils.h
   ;; ../libsnark-caml/caml/vectors.h)
 (action
  (run cp %{deps} .)))
